language: ruby
rvm: 2.3.3
cache:
  bundler: true
  directories:
  - node_modules
branches:
  only:
  - master
before_install:
- nvm install 7.4.0
install:
- npm install
- bundle install --jobs=3 --retry=3 --deployment --path=${BUNDLE_PATH:-vendor/bundle}
before_script:
- git config --global user.name "hnbot"
- git config --global user.email "nygrenh+hnbot@gmail.com"
- export COMMIT_MESSAGE=Update:\ $(git log -1 --pretty=%s)
- git clone -b gh-pages --single-branch https://github.com/materiaalit/tikape-s18.git
  build
script:
- bundle exec middleman build
after_success:
- cd build
- git checkout HEAD README.md .github
- git add --all
- git commit -m "$COMMIT_MESSAGE"
- git push "https://hnbot:$GITHUB_API_KEY@github.com/materiaalit/tikape-s18.git" gh-pages:gh-pages
  2>&1 | sed "s/$GITHUB_API_KEY/<confidential>/g"
env:
  global:
    secure: jovKopT42GChwUspdAXHn3wSRifcveFrfETtD4Lv57uG/wbY1ydrhaaNtwmb5gIZ/1jc0aJyDCSyQ+te6FAxabA1J9D4I66P24zAaxd1aSbL+cFFnSqBKcd4E1XN+LJfPP+UirEr3EpRF89CogIGEZwwMzkdpVGrU0wlVO4USYG4pI6QQGR+xqg9O0i0atBQaYSztOf03+b9qIHJyxhV1AMtnisebDQtuXriubAP2dVYe6wjPmFtzK7tVH13qFgz+hMgKUg6r2piSHqNFe/XuKF7yvpbagpOV97h5OGvkIkNqzfvjPY1hOz3ABdR6eoZbZVCFhw0KmsHi8ROXiZNN8TJzGWxfUmw+t8bqvH4SyqyCmzH2vW4D98C/5nV5r36D+c68J+gYFyaOx0HMDfXC9j6mjGtLu4pvzqmRfuxvqh1h5ZOGhNGtz7uaIWajXUhUYSEDEtdWEmgqkXHYG3aPlGrmS4+skkSoh/gHUGMt6BNfULbWfp6/YwilCUeir7xyAxiNNvfIvbXjwGWoC/6ctBi1Xf/kp7lwiXhpyXTc0m0gRRplGJn9FkFe+S2WNak4UB7913+iwaMXywLuwimCm+3Gvb2bjLOJ/7RyJDRnLgf5XaE9EmeCjI6rqJMrtT3haZCbDoiz3/eOz8ivDlpA2ypdmJSYfKN9rQKDvMiN8g=
